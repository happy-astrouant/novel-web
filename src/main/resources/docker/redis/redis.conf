# redis.conf - Redis 8.0+ 配置文件
port 6379
bind 0.0.0.0
protected-mode yes
tcp-backlog 511
timeout 0
tcp-keepalive 300

# 密码认证（占位符，实际从环境变量或命令行传入）
requirepass 123456

# 持久化配置（RDB）
save 900 1
save 300 10
save 60 10000
rdbcompression yes
rdbchecksum yes
dbfilename dump.rdb
dir /data

# 启用 AOF（更安全的持久化）
appendonly yes
appendfilename "appendonly.aof"
appendfsync everysec
auto-aof-rewrite-percentage 100
auto-aof-rewrite-min-size 64mb

# 内存限制（防止占用过多）
maxmemory 512mb
maxmemory-policy allkeys-lru

# 日志
loglevel notice
logfile ""

# 安全加固：禁用危险命令
rename-command FLUSHDB ""
rename-command FLUSHALL ""
rename-command CONFIG "config-cmd"
rename-command DEBUG ""
rename-command SHUTDOWN ""